# Symmetric N-D boxcar average...
#
# You feed in (image, [sizes]).
# The average is performed only over the first few dimensions -- you specify
# how many in [sizes].
#

sub boxcar {
  my $a = shift;
  my $s_in = pdl(shift);
  my $sizes = ones($a->ndims);
  $sizes->(0:$s_in->nelem-1) .= $s_in;

  my $sl = [$sizes->list];

  my $adp = pdl($a->dims);

  my $ndc = ndcoords(@$sl) - $sizes/2;

  return ($a
	  ->range($ndc,$adp,'e')
	  ->clump($ndc->dim(0))
	  ->average
	  );
}
